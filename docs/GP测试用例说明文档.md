# GP项目完整测试用例说明文档

## 📋 测试概览

**配置KEY**: `gpTestComplete`  
**配置名称**: GP完整测试监控  
**API地址**: `http://localhost:8080/api/xmltest/complete_test_gp_full`  
**项目类型**: GP项目 (procConditionGroup=02)

## 🎯 测试覆盖场景

### 1. 下拉框联动测试
- **多个下拉框**: 工程系列 → 设备类型 → 设备型号 → 设备版本
- **单个下拉框**: 质检工程、运输方式
- **无下拉框**: 包装工序的所有字段

### 2. 数据源混合测试
- **API数据源**: 从XML获取实时数据
- **数据库数据源**: 从生产数据表获取历史数据
- **计算字段**: API和数据库数据的运算结果

### 3. 表格复杂结构测试
- **简单行**: 单项目名 + 单位 + 数值
- **复杂行**: 主项目名 + 多个子项（如基准精度/尺度的L和W）
- **混合数据源表格**: 同一表格包含API和数据库数据

---

## 📊 详细测试用例

### 🔤 **表单区域测试**

#### 测试步骤
1. 在"GP品名"输入框输入：`GP-TEST-001`
2. 按回车键，观察下拉框选项加载
3. 依次选择各下拉框选项
4. 再次按回车键触发数据查询

#### 期望结果

| 下拉框 | 配置表达式 | 预期选项 | 说明 |
|--------|-----------|----------|------|
| 工程系列 | 001;2;2 | 工程系列A, 工程系列B | cd=001的item_2字段 |
| 设备类型 | 001;2;7 | A型, B型 | cd=001的item_7字段 |
| 设备型号 | 001;2;8 | A1型, A2型, B1型 | cd=001的item_8字段 |
| 设备版本 | 001;2;9 | V1.0, V2.0 | cd=001的item_9字段 |
| 质检工程 | 002;2;2 | 质检工程A, 质检工程B | cd=002的item_2字段 |
| 运输方式 | 004;2;2 | 运输方式A, 运输方式B | cd=004的item_2字段 |

#### 联动测试场景
- **场景1**: 选择"工程系列A" → 设备类型应显示"A型" → 型号显示"A1型, A2型" → 版本显示"V1.0"
- **场景2**: 选择"工程系列B" → 设备类型应显示"B型" → 型号显示"B1型" → 版本显示"V2.0"

---

### 📝 **基础信息区域测试**

| 字段名 | 数据源 | 配置表达式 | 预期值 | 验证点 |
|-------|--------|-----------|--------|--------|
| GP品名(API) | API | 001;3;1 | GP-TEST-001 | API直接获取 |
| 工程系列(API) | API | 001;3;2 | 工程系列A | API直接获取 |
| 设备类型(API) | API | 001;3;7 | A型 | API直接获取 |
| 温度(API) | API | 001;3;10 | 25.5 | API数值字段 |
| 湿度(API) | API | 001;3;11 | 60 | API数值字段 |
| 平均温湿度(API-计算) | API | (temperature + humidity) / 2 | 42.75 | 计算字段：(25.5+60)/2 |
| 作业员1(DB) | 数据库 | SELECT operator1... | 张三 | 数据库查询 |
| 班次1(DB) | 数据库 | SELECT shift1... | 白班 | 数据库查询 |
| 生产日期1(DB) | 数据库 | SELECT product_date1... | 2025-01-15 | 数据库查询 |
| 质检速度(cd=002) | API | 002;3;11 | 85.5 | 不同cd的API数据 |

---

### 💬 **备注区域测试**

| 备注标题 | 数据源 | 预期内容 |
|---------|--------|----------|
| 生产备注1(DB) | 数据库 | GP-TEST-001生产数据测试，包含多种加工条件种cd的完整测试数据... |
| 生产备注2(DB) | 数据库 | GP测试项目运行正常，所有下拉框联动功能正常... |

---

### 📋 **表格区域测试**

#### 表格1: 印刷检查、面积检查

| 行类型 | 项目名 | 子项名 | 单位 | 数据源 | 预期值 | 验证点 |
|-------|--------|--------|------|--------|--------|--------|
| 简单行 | GP处置项次 | - | - | 数据库 | GP处置项次001 | 简单行无单位 |
| 简单行 | 三温炉时间 | - | - | 数据库 | 120秒 | 简单行无单位 |
| 简单行 | 速度 | - | m/min | 数据库 | 14.5 | 简单行有单位 |
| 简单行 | 炉温（开/关/开） | - | - | 数据库 | 240℃/关/240℃ | 简单行无单位 |
| 简单行 | GP量 | - | um | 数据库 | 25.8 | 简单行有单位 |
| 复杂行 | 基准精度/尺度 | L | um | 数据库 | 12.5 | 复杂行主项目 |
| 复杂行 | - | W | um | 数据库 | 8.3 | 复杂行子项目 |

#### 表格2: 温度检查

| 行类型 | 项目名 | 单位 | 数据源 | 预期值 |
|-------|--------|------|--------|--------|
| 简单行 | 预热温度 | - | 数据库 | 80℃ |
| 简单行 | 加热温度 | - | 数据库 | 240℃ |
| 简单行 | 冷却温度 | - | 数据库 | 25℃ |

#### 表格3: API数据验证

| 行类型 | 项目名 | 子项名 | 单位 | 数据源 | 预期值 | 验证点 |
|-------|--------|--------|------|--------|--------|--------|
| 简单行 | API温度(cd=001) | - | ℃ | API | 25.5 | API直接数据 |
| 简单行 | API速度(cd=002) | - | m/s | API | 85.5 | 不同cd的API |
| 复杂行 | 混合数据源 | API数据 | - | API | 额外字段A1V1 | API数据 |
| 复杂行 | - | DB计算 | - | 数据库 | 29.0 | 计算字段：14.5*2 |

---

## 🔍 **特殊测试场景**

### 1. 品名隔离测试
**输入**: `GP-TEST-002`
**预期**: 显示不同的下拉框选项（工程系列C、质检工程C）和对应的数据

### 2. 无数据测试
**输入**: `GP-NONEXIST`
**预期**: 下拉框为空，基础信息和表格显示空值或默认值

### 3. 部分数据测试
**输入**: `GP-TEST-001`，但只选择部分下拉框
**预期**: 已选择的数据正常显示，未选择的相关数据为空

---

## ⚠️ **常见问题排查**

### 问题1: 下拉框选项不显示
- **检查**: XML API是否正常响应
- **验证**: 访问 `http://localhost:8080/api/xmltest/complete_test_gp_full`
- **期望**: 返回完整XML数据

### 问题2: 基础信息显示异常
- **检查**: API数据是否包含对应字段
- **验证**: 查看 item_10 (温度) 和 item_11 (湿度) 是否存在
- **期望**: 数值类型字段正确解析

### 问题3: 计算字段错误
- **检查**: 参与计算的变量是否都有值
- **验证**: temperature 和 humidity 是否都被正确提取
- **期望**: (25.5 + 60) / 2 = 42.75

### 问题4: 数据库数据不显示
- **检查**: 数据库连接和SQL语句
- **验证**: 手动执行SQL确认数据存在
- **期望**: 返回对应的生产数据

### 问题5: 表格显示异常
- **检查**: 简单行和复杂行的rowType配置
- **验证**: 复杂行的subRows是否正确配置
- **期望**: 基准精度/尺度显示为主项目，L和W为子项目

---

## 📈 **性能测试点**

1. **SQL合并优化**: 多个数据库查询应合并为少量SQL执行
2. **XML缓存**: 相同参数的XML数据应使用缓存
3. **响应时间**: 整体数据加载时间应在2秒内
4. **并发测试**: 多用户同时访问不应相互影响

---

## ✅ **测试检查清单**

- [ ] 所有下拉框选项正确加载
- [ ] 下拉框联动功能正常
- [ ] API数据源正常获取和显示
- [ ] 数据库数据源正常查询和显示
- [ ] 计算字段结果正确
- [ ] 简单行表格显示正确
- [ ] 复杂行表格显示正确（主项目+子项目）
- [ ] 混合数据源表格正常工作
- [ ] 品名隔离功能正常
- [ ] 缓存机制正常工作
- [ ] 错误处理正常（无数据、网络异常等）
- [ ] 性能满足要求

## 🎯 **测试完成标准**

所有检查清单项目都通过，且满足以下条件：
1. 数据显示准确性 100%
2. 功能完整性 100%
3. 用户体验良好
4. 无明显性能问题
5. 错误处理健壮
