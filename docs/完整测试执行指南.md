# 监控系统完整测试执行指南

## 🚀 快速开始

### 1. 环境准备
```bash
# 1. 启动后端服务
cd c:\Users\Administrator\Desktop\RuoYi-Vue
# 确保数据库连接正常，启动应用

# 2. 启动前端服务  
cd ruoyi-ui
npm run dev
```

### 2. 数据初始化
按顺序执行以下SQL文件：

```sql
-- 1. 执行基础数据
mysql -u root -p ry_user < sql/complete_test_data.sql

-- 2. 执行监控配置
mysql -u root -p ry_monitor < sql/complete_test_monitor_config.sql
```

### 3. XML测试数据上传
使用Postman或curl上传XML测试数据：

```bash
# GP项目XML数据
curl -X POST http://localhost:8080/api/xmltest/store/complete_test_gp_full \
  -H "Content-Type: application/xml" \
  -d @xml_test_data/complete_test_gp_full.xml

# LCP项目XML数据  
curl -X POST http://localhost:8080/api/xmltest/store/complete_test_lcp_full \
  -H "Content-Type: application/xml" \
  -d @xml_test_data/complete_test_lcp_full.xml
```

---

## 📊 测试覆盖矩阵

### 功能覆盖

| 功能模块 | GP项目 | LCP项目 | 测试要点 |
|---------|-------|---------|----------|
| **下拉框联动** | ✅ | ✅ | 多级联动、单选、无选项 |
| **API数据源** | ✅ | ✅ | 直接获取、计算字段 |
| **数据库数据源** | ✅ | ✅ | SQL查询、参数化 |
| **混合数据源** | ✅ | ✅ | 同时使用API和DB |
| **简单行表格** | ✅ | ✅ | 有单位、无单位 |
| **复杂行表格** | ✅ | ✅ | 主项目+子项目 |
| **分隔符清理** | ❌ | ✅ | 非GP项目特有 |
| **品名隔离** | ✅ | ✅ | 数据相互独立 |

### 数据源组合测试

| 场景 | cd值 | 下拉框数量 | API字段 | DB表 | 说明 |
|------|-----|----------|---------|------|------|
| **基础加工** | 001 | 4-5个 | ✅ | ✅ | 核心功能测试 |
| **质检/检测** | 002 | 1-2个 | ✅ | ❌ | 单选+API |
| **包装/封装** | 003 | 0个 | ❌ | ✅ | 纯DB数据 |
| **运输/物流** | 004 | 1个 | 部分 | ❌ | 混合场景 |

---

## 🎯 分步测试执行

### 阶段1: GP项目测试 (gpTestComplete)

#### 步骤1: 基础功能验证
1. **访问页面**: http://localhost:8080/#/monitor/gpTestComplete
2. **输入品名**: `GP-TEST-001`
3. **按回车键**，验证下拉框加载
4. **期望结果**: 
   - 工程系列: 工程系列A, 工程系列B
   - 设备类型: A型, B型  
   - 设备型号: A1型, A2型, B1型
   - 设备版本: V1.0, V2.0
   - 质检工程: 质检工程A, 质检工程B
   - 运输方式: 运输方式A, 运输方式B

#### 步骤2: 联动测试
1. **选择**: 工程系列A → 设备类型A型 → 设备型号A1型 → 设备版本V1.0
2. **再次按回车**，触发数据查询
3. **验证基础信息**:
   - GP品名(API): GP-TEST-001
   - 工程系列(API): 工程系列A
   - 设备类型(API): A型
   - 温度(API): 25.5
   - 湿度(API): 60
   - 平均温湿度(API-计算): 42.75
   - 作业员1(DB): 张三
   - 班次1(DB): 白班

#### 步骤3: 表格数据验证
验证三个表格的数据正确性：
1. **印刷检查表格**: GP处置项次001, 120秒, 14.5 m/min等
2. **温度检查表格**: 80℃, 240℃, 25℃
3. **API数据验证表格**: 混合数据源正常工作

#### 步骤4: 错误场景测试
1. **输入无效品名**: `GP-INVALID`
2. **验证**: 下拉框为空，数据显示默认值
3. **输入第二个品名**: `GP-TEST-002`
4. **验证**: 显示不同的选项和数据（品名隔离）

---

### 阶段2: LCP项目测试 (lcpTestComplete)

#### 步骤1: 分隔符清理验证
1. **访问页面**: http://localhost:8080/#/monitor/lcpTestComplete
2. **输入品名**: `LCP-TEST-001`
3. **按回车键**，验证XML分隔符清理
4. **期望结果**:
   - 加工系列: 加工系列X, 加工系列Y, 加工系列Z
   - 设备类型: X型设备, Y型设备, Z型设备
   - 设备型号: X1型号, X2型号, Y1型号, Z1型号
   - 设备版本: Ver1.0, Ver1.5, Ver2.0, Ver3.0

#### 步骤2: 非GP项目特有功能
1. **选择**: 加工系列X → 设备类型X型设备 → 设备型号X1型号
2. **验证API数据获取**（分隔符清理后）:
   - 设备类型(API): X型设备（原item_5清理到item_4）
   - 加工温度(API): 85.5（原item_11清理到item_7）
   - 加工速度(API): 12.5（原item_13清理到item_8）
   - 温度速度乘积: 1068.75（85.5 × 12.5）

#### 步骤3: 多cd场景验证
1. **验证cd=001**: 基础加工数据
2. **验证cd=002**: 检测数据（检测类型A, B, Z）
3. **验证cd=003**: 封装数据（无下拉框）
4. **验证cd=004**: 物流数据（物流模式A, B）

#### 步骤4: 品名隔离测试
1. **输入**: `LCP-TEST-002`
2. **验证**: 加工系列Z、检测类型Z等专属选项

---

### 阶段3: 性能和稳定性测试

#### 缓存功能测试
1. **多次查询相同参数**，观察响应时间
2. **预期**: 第二次查询应使用缓存，响应更快
3. **验证**: 后台日志显示"缓存命中"

#### 并发测试
1. **多个浏览器标签页**同时访问
2. **不同品名**同时查询
3. **验证**: 数据不互相干扰，缓存正确隔离

#### SQL合并优化验证
1. **查看后台SQL日志**
2. **验证**: 多个字段查询合并为少量SQL执行
3. **预期**: 性能提升明显

---

## 🔍 问题诊断指南

### 常见问题及解决方案

#### 1. 下拉框不显示选项
```bash
# 检查XML API
curl http://localhost:8080/api/xmltest/complete_test_gp_full

# 检查返回数据格式
# 确保包含<trafficParam><pattern><row><item>结构
```

#### 2. 基础信息显示异常
```bash
# 检查API数据解析
# GP项目: item_5为cd位置
# LCP项目: item_3为cd位置，需要分隔符清理

# 验证计算字段
# 确保参与计算的变量都有值
```

#### 3. 数据库数据不显示
```sql
-- 验证数据存在
SELECT * FROM gp_production_data WHERE gp_name = 'GP-TEST-001';
SELECT * FROM lcp_production_data WHERE lcp_name = 'LCP-TEST-001';

-- 检查SQL参数化
-- 确保 :gpName 和 :lcpName 参数正确传递
```

#### 4. 表格显示异常
- **检查rowType配置**: simple vs complex
- **验证subRows结构**: 复杂行的子项目配置
- **确认数据源混合**: API和数据库数据正确获取

---

## 📈 测试报告模板

### 测试执行记录

| 测试项 | GP项目 | LCP项目 | 状态 | 备注 |
|-------|-------|---------|------|------|
| 下拉框加载 | ⭕ | ⭕ | | |
| 下拉框联动 | ⭕ | ⭕ | | |
| API数据源 | ⭕ | ⭕ | | |
| 数据库数据源 | ⭕ | ⭕ | | |
| 计算字段 | ⭕ | ⭕ | | |
| 简单行表格 | ⭕ | ⭕ | | |
| 复杂行表格 | ⭕ | ⭕ | | |
| 混合数据源表格 | ⭕ | ⭕ | | |
| 分隔符清理 | N/A | ⭕ | | LCP特有 |
| 品名隔离 | ⭕ | ⭕ | | |
| 缓存机制 | ⭕ | ⭕ | | |
| 错误处理 | ⭕ | ⭕ | | |

*⭕ = 待测试, ✅ = 通过, ❌ = 失败*

### 性能指标

| 指标 | 预期值 | 实际值 | 状态 |
|------|--------|--------|------|
| 首次加载时间 | <2秒 |  | |
| 缓存命中响应 | <500ms |  | |
| 下拉框联动延迟 | <1秒 |  | |
| 表格渲染时间 | <1秒 |  | |

---

## ✅ 测试完成检查清单

### 功能测试 (必须全部通过)
- [ ] GP项目所有下拉框选项正确
- [ ] LCP项目所有下拉框选项正确（含分隔符清理）
- [ ] 下拉框联动功能正常
- [ ] API数据源获取正确
- [ ] 数据库数据源查询正确
- [ ] 计算字段结果准确
- [ ] 简单行表格显示正确
- [ ] 复杂行表格显示正确
- [ ] 混合数据源表格正常
- [ ] 品名隔离功能正常
- [ ] 错误场景处理正确

### 性能测试 (建议全部满足)
- [ ] 响应时间满足要求
- [ ] 缓存机制正常工作
- [ ] SQL合并优化生效
- [ ] 并发访问正常
- [ ] 内存使用合理

### 用户体验 (建议全部满足)
- [ ] 界面响应流畅
- [ ] 加载状态提示清晰
- [ ] 错误信息友好
- [ ] 数据展示美观
- [ ] 交互逻辑直观

## 🎯 测试通过标准

- **功能完整性**: 100% (所有功能测试项通过)
- **数据准确性**: 100% (所有数据验证通过)
- **性能满足度**: ≥80% (关键性能指标满足)
- **用户体验**: 优良 (界面友好，操作流畅)

测试完成后，系统应该能够：
1. 正确处理GP和LCP两种项目类型
2. 支持多种复杂的下拉框联动场景
3. 混合使用API和数据库数据源
4. 提供良好的性能和用户体验
5. 具备完善的错误处理能力
